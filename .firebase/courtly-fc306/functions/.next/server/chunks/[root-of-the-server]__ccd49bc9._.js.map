{"version":3,"sources":["../../../lib/firebase/admin.ts"],"sourcesContent":["import \"server-only\"\n\nimport { initializeApp, cert, getApps, getApp } from \"firebase-admin/app\"\nimport { getAuth } from \"firebase-admin/auth\"\nimport { getFirestore } from \"firebase-admin/firestore\"\n\nlet cachedApp: ReturnType<typeof getApp> | null = null\n\nfunction normalizePrivateKey(raw: string) {\n  const normalized = raw.trim()\n  const unquoted = normalized.replace(/^\"(.*)\"$/s, \"$1\").replace(/^'(.*)'$/s, \"$1\")\n  const withEscaped = unquoted\n    .replace(/\\\\\\\\n/g, \"\\n\")\n    .replace(/\\\\\\\\r/g, \"\\r\")\n    .replace(/\\\\n/g, \"\\n\")\n    .replace(/\\\\r/g, \"\\r\")\n  return withEscaped.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\")\n}\n\nfunction getAdminApp() {\n  if (cachedApp) return cachedApp\n\n  const projectId = process.env.FIREBASE_ADMIN_PROJECT_ID\n  const clientEmail = process.env.FIREBASE_ADMIN_CLIENT_EMAIL\n  const privateKeyRaw = process.env.FIREBASE_ADMIN_PRIVATE_KEY\n\n  if (!projectId || !clientEmail || !privateKeyRaw) {\n    throw new Error(\n      \"Firebase Admin is not configured. Set FIREBASE_ADMIN_PROJECT_ID, FIREBASE_ADMIN_CLIENT_EMAIL, and FIREBASE_ADMIN_PRIVATE_KEY.\"\n    )\n  }\n\n  const privateKey = normalizePrivateKey(privateKeyRaw)\n  \n  console.log(\"[Firebase/admin] privateKeyRaw length:\", privateKeyRaw.length)\n  console.log(\"[Firebase/admin] privateKey length:\", privateKey.length)\n  console.log(\"[Firebase/admin] privateKey first 50:\", privateKey.slice(0, 50))\n  console.log(\"[Firebase/admin] privateKey last 50:\", privateKey.slice(-50))\n\n  if (!privateKey.includes(\"BEGIN PRIVATE KEY\") || !privateKey.includes(\"END PRIVATE KEY\")) {\n    throw new Error(\n      \"Firebase Admin private key is invalid. Ensure FIREBASE_ADMIN_PRIVATE_KEY is a single line with \\\\n escapes.\"\n    )\n  }\n\n  const hasDefaultApp = getApps().some((existing) => existing.name === \"[DEFAULT]\")\n\n  cachedApp = hasDefaultApp\n    ? getApp()\n    : initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail,\n          privateKey,\n        }),\n        projectId,\n      })\n\n  return cachedApp\n}\n\nexport const adminAuth = new Proxy({} as ReturnType<typeof getAuth>, {\n  get(_target, prop) {\n    const auth = getAuth(getAdminApp()) as any\n    const value = auth[prop]\n    return typeof value === \"function\" ? value.bind(auth) : value\n  },\n})\n\nexport const adminDb = new Proxy({} as ReturnType<typeof getFirestore>, {\n  get(_target, prop) {\n    const db = getFirestore(getAdminApp()) as any\n    const value = db[prop]\n    return typeof value === \"function\" ? value.bind(db) : value\n  },\n})\n"],"names":[],"mappings":"2rCAAA,EAAA,CAAA,CAAA,OAEA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,KACA,EAAA,EAAA,CAAA,CAAA,iDAEA,IAAI,EAA8C,KAalD,SAAS,IACP,GAAI,EAAW,OAAO,EAEtB,IAAM,EAAY,QAAQ,GAAG,CAAC,yBAAyB,CACjD,EAAc,QAAQ,GAAG,CAAC,2BAA2B,CACrD,EAAgB,QAAQ,GAAG,CAAC,0BAA0B,CAE5D,GAAI,CAAC,GAAa,CAAC,GAAe,CAAC,EACjC,MAAM,AAAI,MACR,CAF8C,gIAMlD,IAAM,EAAiC,AAhBhC,AAPY,AACF,AACG,EAFG,IAAI,GACC,EAsBT,KAtBgB,CAAC,YAAa,MAAM,OAAO,CAAC,YAAa,MAEzE,OAAO,CAAC,SAAU,MAClB,OAAO,CAAC,SAAU,MAClB,OAAO,CAAC,OAAQ,MAChB,OAAO,CAAC,OAAQ,MACA,OAAO,CAAC,QAAS,MAAM,OAAO,CAAC,MAAO,IAuBzD,GALA,QAAQ,GAAG,CAAC,yCAA0C,EAAc,MAAM,EAC1E,QAAQ,GAAG,CAAC,sCAAuC,EAAW,MAAM,EACpE,QAAQ,GAAG,CAAC,wCAAyC,EAAW,KAAK,CAAC,EAAG,KACzE,QAAQ,GAAG,CAAC,uCAAwC,EAAW,KAAK,CAAC,CAAC,KAElE,CAAC,EAAW,QAAQ,CAAC,sBAAwB,CAAC,EAAW,QAAQ,CAAC,mBACpE,CADwF,KAClF,AAAI,MACR,+GAiBJ,OAXA,AAWO,EAbe,AAEV,CAFU,EAAA,EAAA,OAAA,AAAO,IAAG,IAAI,CAAC,AAAC,GAA+B,cAAlB,EAAS,IAAI,EAG5D,CAAA,EAAA,EAAA,MAAA,AAAM,IACN,CAAA,EAAA,EAAA,aAAA,AAAa,EAAC,CACZ,WAAY,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,WACf,cACA,aACA,CACF,aACA,CACF,EAGN,CAEO,IAAM,EAAY,IAAI,MAAM,CAAC,EAAiC,CACnE,IAAI,CAAO,CAAE,CAAI,EACf,IAAM,EAAO,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,KACf,EAAQ,CAAI,CAAC,EAAK,CACxB,MAAwB,YAAjB,OAAO,EAAuB,EAAM,IAAI,CAAC,GAAQ,CAC1D,CACF,GAEa,EAAU,IAAI,MAAM,CAAC,EAAsC,CACtE,IAAI,CAAO,CAAE,CAAI,EACf,IAAM,EAAK,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,KAClB,EAAQ,CAAE,CAAC,EAAK,CACtB,MAAwB,YAAjB,OAAO,EAAuB,EAAM,IAAI,CAAC,GAAM,CACxD,CACF"}
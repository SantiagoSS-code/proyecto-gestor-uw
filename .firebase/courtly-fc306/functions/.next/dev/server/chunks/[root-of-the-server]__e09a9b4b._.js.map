{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/santisanchez/Documents/GitHub/proyecto-gestor-uw/lib/firebase/admin.ts"],"sourcesContent":["import \"server-only\"\n\nimport { initializeApp, cert, getApps, getApp } from \"firebase-admin/app\"\nimport { getAuth } from \"firebase-admin/auth\"\nimport { getFirestore } from \"firebase-admin/firestore\"\n\nlet cachedApp: ReturnType<typeof getApp> | null = null\n\nfunction normalizePrivateKey(raw: string) {\n  const normalized = raw.trim()\n  const unquoted = normalized.replace(/^\"(.*)\"$/s, \"$1\").replace(/^'(.*)'$/s, \"$1\")\n  const withEscaped = unquoted\n    .replace(/\\\\\\\\n/g, \"\\n\")\n    .replace(/\\\\\\\\r/g, \"\\r\")\n    .replace(/\\\\n/g, \"\\n\")\n    .replace(/\\\\r/g, \"\\r\")\n  return withEscaped.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\")\n}\n\nfunction getAdminApp() {\n  if (cachedApp) return cachedApp\n\n  const projectId = process.env.FIREBASE_ADMIN_PROJECT_ID\n  const clientEmail = process.env.FIREBASE_ADMIN_CLIENT_EMAIL\n  const privateKeyRaw = process.env.FIREBASE_ADMIN_PRIVATE_KEY\n\n  if (!projectId || !clientEmail || !privateKeyRaw) {\n    throw new Error(\n      \"Firebase Admin is not configured. Set FIREBASE_ADMIN_PROJECT_ID, FIREBASE_ADMIN_CLIENT_EMAIL, and FIREBASE_ADMIN_PRIVATE_KEY.\"\n    )\n  }\n\n  const privateKey = normalizePrivateKey(privateKeyRaw)\n  \n  console.log(\"[Firebase/admin] privateKeyRaw length:\", privateKeyRaw.length)\n  console.log(\"[Firebase/admin] privateKey length:\", privateKey.length)\n  console.log(\"[Firebase/admin] privateKey first 50:\", privateKey.slice(0, 50))\n  console.log(\"[Firebase/admin] privateKey last 50:\", privateKey.slice(-50))\n\n  if (!privateKey.includes(\"BEGIN PRIVATE KEY\") || !privateKey.includes(\"END PRIVATE KEY\")) {\n    throw new Error(\n      \"Firebase Admin private key is invalid. Ensure FIREBASE_ADMIN_PRIVATE_KEY is a single line with \\\\n escapes.\"\n    )\n  }\n\n  const hasDefaultApp = getApps().some((existing) => existing.name === \"[DEFAULT]\")\n\n  cachedApp = hasDefaultApp\n    ? getApp()\n    : initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail,\n          privateKey,\n        }),\n        projectId,\n      })\n\n  return cachedApp\n}\n\nexport const adminAuth = new Proxy({} as ReturnType<typeof getAuth>, {\n  get(_target, prop) {\n    const auth = getAuth(getAdminApp()) as any\n    const value = auth[prop]\n    return typeof value === \"function\" ? value.bind(auth) : value\n  },\n})\n\nexport const adminDb = new Proxy({} as ReturnType<typeof getFirestore>, {\n  get(_target, prop) {\n    const db = getFirestore(getAdminApp()) as any\n    const value = db[prop]\n    return typeof value === \"function\" ? value.bind(db) : value\n  },\n})\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;AACA;;;;;;;;;;;AAEA,IAAI,YAA8C;AAElD,SAAS,oBAAoB,GAAW;IACtC,MAAM,aAAa,IAAI,IAAI;IAC3B,MAAM,WAAW,WAAW,OAAO,CAAC,aAAa,MAAM,OAAO,CAAC,aAAa;IAC5E,MAAM,cAAc,SACjB,OAAO,CAAC,UAAU,MAClB,OAAO,CAAC,UAAU,MAClB,OAAO,CAAC,QAAQ,MAChB,OAAO,CAAC,QAAQ;IACnB,OAAO,YAAY,OAAO,CAAC,SAAS,MAAM,OAAO,CAAC,OAAO;AAC3D;AAEA,SAAS;IACP,IAAI,WAAW,OAAO;IAEtB,MAAM,YAAY,QAAQ,GAAG,CAAC,yBAAyB;IACvD,MAAM,cAAc,QAAQ,GAAG,CAAC,2BAA2B;IAC3D,MAAM,gBAAgB,QAAQ,GAAG,CAAC,0BAA0B;IAE5D,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,eAAe;QAChD,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,aAAa,oBAAoB;IAEvC,QAAQ,GAAG,CAAC,0CAA0C,cAAc,MAAM;IAC1E,QAAQ,GAAG,CAAC,uCAAuC,WAAW,MAAM;IACpE,QAAQ,GAAG,CAAC,yCAAyC,WAAW,KAAK,CAAC,GAAG;IACzE,QAAQ,GAAG,CAAC,wCAAwC,WAAW,KAAK,CAAC,CAAC;IAEtE,IAAI,CAAC,WAAW,QAAQ,CAAC,wBAAwB,CAAC,WAAW,QAAQ,CAAC,oBAAoB;QACxF,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,gBAAgB,IAAA,2JAAO,IAAG,IAAI,CAAC,CAAC,WAAa,SAAS,IAAI,KAAK;IAErE,YAAY,gBACR,IAAA,0JAAM,MACN,IAAA,iKAAa,EAAC;QACZ,YAAY,IAAA,wJAAI,EAAC;YACf;YACA;YACA;QACF;QACA;IACF;IAEJ,OAAO;AACT;AAEO,MAAM,YAAY,IAAI,MAAM,CAAC,GAAiC;IACnE,KAAI,OAAO,EAAE,IAAI;QACf,MAAM,OAAO,IAAA,6JAAO,EAAC;QACrB,MAAM,QAAQ,IAAI,CAAC,KAAK;QACxB,OAAO,OAAO,UAAU,aAAa,MAAM,IAAI,CAAC,QAAQ;IAC1D;AACF;AAEO,MAAM,UAAU,IAAI,MAAM,CAAC,GAAsC;IACtE,KAAI,OAAO,EAAE,IAAI;QACf,MAAM,KAAK,IAAA,4KAAY,EAAC;QACxB,MAAM,QAAQ,EAAE,CAAC,KAAK;QACtB,OAAO,OAAO,UAAU,aAAa,MAAM,IAAI,CAAC,MAAM;IACxD;AACF"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///Users/santisanchez/Documents/GitHub/proyecto-gestor-uw/proxy.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { adminAuth } from \"@/lib/firebase/admin\"\n\nexport async function proxy(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Protect /dashboard routes\n  if (pathname.startsWith('/dashboard')) {\n    const token = request.cookies.get('__session')?.value;\n    if (!token) {\n      return NextResponse.redirect(new URL('/auth/login', request.url));\n    }\n\n    try {\n      const decodedToken = await adminAuth.verifyIdToken(token);\n      if (!decodedToken.email_verified) {\n        return NextResponse.redirect(new URL('/auth/verify-email', request.url));\n      }\n    } catch {\n      return NextResponse.redirect(new URL('/auth/login', request.url));\n    }\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\"/dashboard/:path*\"],\n}"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;;;;;AAEO,eAAe,MAAM,OAAoB;IAC9C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,4BAA4B;IAC5B,IAAI,SAAS,UAAU,CAAC,eAAe;QACrC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;QAChD,IAAI,CAAC,OAAO;YACV,OAAO,sTAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;QAEA,IAAI;YACF,MAAM,eAAe,MAAM,qIAAS,CAAC,aAAa,CAAC;YACnD,IAAI,CAAC,aAAa,cAAc,EAAE;gBAChC,OAAO,sTAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sBAAsB,QAAQ,GAAG;YACxE;QACF,EAAE,OAAM;YACN,OAAO,sTAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;IACF;IAEA,OAAO,sTAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAoB;AAChC"}}]
}
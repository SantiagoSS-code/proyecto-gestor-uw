{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/santisanchez/Documents/GitHub/proyecto-gestor-uw/lib/firebase/admin.ts"],"sourcesContent":["import \"server-only\"\n\nimport { initializeApp, cert, getApps, getApp } from \"firebase-admin/app\"\nimport { getAuth } from \"firebase-admin/auth\"\nimport { getFirestore } from \"firebase-admin/firestore\"\n\nlet cachedApp: ReturnType<typeof getApp> | null = null\n\nfunction normalizePrivateKey(raw: string) {\n  const normalized = raw.trim()\n  const unquoted = normalized.replace(/^\"(.*)\"$/s, \"$1\").replace(/^'(.*)'$/s, \"$1\")\n  const withEscaped = unquoted\n    .replace(/\\\\\\\\n/g, \"\\n\")\n    .replace(/\\\\\\\\r/g, \"\\r\")\n    .replace(/\\\\n/g, \"\\n\")\n    .replace(/\\\\r/g, \"\\r\")\n  return withEscaped.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\")\n}\n\nfunction getAdminApp() {\n  if (cachedApp) return cachedApp\n\n  const projectId = process.env.FIREBASE_ADMIN_PROJECT_ID\n  const clientEmail = process.env.FIREBASE_ADMIN_CLIENT_EMAIL\n  const privateKeyRaw = process.env.FIREBASE_ADMIN_PRIVATE_KEY\n\n  if (!projectId || !clientEmail || !privateKeyRaw) {\n    throw new Error(\n      \"Firebase Admin is not configured. Set FIREBASE_ADMIN_PROJECT_ID, FIREBASE_ADMIN_CLIENT_EMAIL, and FIREBASE_ADMIN_PRIVATE_KEY.\"\n    )\n  }\n\n  const privateKey = normalizePrivateKey(privateKeyRaw)\n  \n  console.log(\"[Firebase/admin] privateKeyRaw length:\", privateKeyRaw.length)\n  console.log(\"[Firebase/admin] privateKey length:\", privateKey.length)\n  console.log(\"[Firebase/admin] privateKey first 50:\", privateKey.slice(0, 50))\n  console.log(\"[Firebase/admin] privateKey last 50:\", privateKey.slice(-50))\n\n  if (!privateKey.includes(\"BEGIN PRIVATE KEY\") || !privateKey.includes(\"END PRIVATE KEY\")) {\n    throw new Error(\n      \"Firebase Admin private key is invalid. Ensure FIREBASE_ADMIN_PRIVATE_KEY is a single line with \\\\n escapes.\"\n    )\n  }\n\n  const hasDefaultApp = getApps().some((existing) => existing.name === \"[DEFAULT]\")\n\n  cachedApp = hasDefaultApp\n    ? getApp()\n    : initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail,\n          privateKey,\n        }),\n        projectId,\n      })\n\n  return cachedApp\n}\n\nexport const adminAuth = new Proxy({} as ReturnType<typeof getAuth>, {\n  get(_target, prop) {\n    const auth = getAuth(getAdminApp()) as any\n    const value = auth[prop]\n    return typeof value === \"function\" ? value.bind(auth) : value\n  },\n})\n\nexport const adminDb = new Proxy({} as ReturnType<typeof getFirestore>, {\n  get(_target, prop) {\n    const db = getFirestore(getAdminApp()) as any\n    const value = db[prop]\n    return typeof value === \"function\" ? value.bind(db) : value\n  },\n})\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;AACA;;;;;;;;;;;AAEA,IAAI,YAA8C;AAElD,SAAS,oBAAoB,GAAW;IACtC,MAAM,aAAa,IAAI,IAAI;IAC3B,MAAM,WAAW,WAAW,OAAO,CAAC,aAAa,MAAM,OAAO,CAAC,aAAa;IAC5E,MAAM,cAAc,SACjB,OAAO,CAAC,UAAU,MAClB,OAAO,CAAC,UAAU,MAClB,OAAO,CAAC,QAAQ,MAChB,OAAO,CAAC,QAAQ;IACnB,OAAO,YAAY,OAAO,CAAC,SAAS,MAAM,OAAO,CAAC,OAAO;AAC3D;AAEA,SAAS;IACP,IAAI,WAAW,OAAO;IAEtB,MAAM,YAAY,QAAQ,GAAG,CAAC,yBAAyB;IACvD,MAAM,cAAc,QAAQ,GAAG,CAAC,2BAA2B;IAC3D,MAAM,gBAAgB,QAAQ,GAAG,CAAC,0BAA0B;IAE5D,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,eAAe;QAChD,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,aAAa,oBAAoB;IAEvC,QAAQ,GAAG,CAAC,0CAA0C,cAAc,MAAM;IAC1E,QAAQ,GAAG,CAAC,uCAAuC,WAAW,MAAM;IACpE,QAAQ,GAAG,CAAC,yCAAyC,WAAW,KAAK,CAAC,GAAG;IACzE,QAAQ,GAAG,CAAC,wCAAwC,WAAW,KAAK,CAAC,CAAC;IAEtE,IAAI,CAAC,WAAW,QAAQ,CAAC,wBAAwB,CAAC,WAAW,QAAQ,CAAC,oBAAoB;QACxF,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,gBAAgB,IAAA,2JAAO,IAAG,IAAI,CAAC,CAAC,WAAa,SAAS,IAAI,KAAK;IAErE,YAAY,gBACR,IAAA,0JAAM,MACN,IAAA,iKAAa,EAAC;QACZ,YAAY,IAAA,wJAAI,EAAC;YACf;YACA;YACA;QACF;QACA;IACF;IAEJ,OAAO;AACT;AAEO,MAAM,YAAY,IAAI,MAAM,CAAC,GAAiC;IACnE,KAAI,OAAO,EAAE,IAAI;QACf,MAAM,OAAO,IAAA,6JAAO,EAAC;QACrB,MAAM,QAAQ,IAAI,CAAC,KAAK;QACxB,OAAO,OAAO,UAAU,aAAa,MAAM,IAAI,CAAC,QAAQ;IAC1D;AACF;AAEO,MAAM,UAAU,IAAI,MAAM,CAAC,GAAsC;IACtE,KAAI,OAAO,EAAE,IAAI;QACf,MAAM,KAAK,IAAA,4KAAY,EAAC;QACxB,MAAM,QAAQ,EAAE,CAAC,KAAK;QACtB,OAAO,OAAO,UAAU,aAAa,MAAM,IAAI,CAAC,MAAM;IACxD;AACF"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///Users/santisanchez/Documents/GitHub/proyecto-gestor-uw/app/api/auth/session/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { adminAuth } from \"@/lib/firebase/admin\"\n\nconst SESSION_COOKIE_NAME = \"__session\"\n\nfunction decodeJwtPayload(token: string) {\n  const parts = token.split(\".\")\n  if (parts.length < 2) return null\n  try {\n    const padded = parts[1].replace(/-/g, \"+\").replace(/_/g, \"/\") + \"===\".slice((parts[1].length + 3) % 4)\n    return JSON.parse(Buffer.from(padded, \"base64\").toString(\"utf8\")) as Record<string, any>\n  } catch {\n    return null\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = (await request.json().catch(() => null)) as null | { idToken?: string }\n    const idToken = body?.idToken\n\n    if (!idToken) {\n      return NextResponse.json({ error: \"Missing idToken\" }, { status: 400 })\n    }\n\n    const payload = decodeJwtPayload(idToken)\n\n    if (process.env.NODE_ENV === \"development\") {\n      const adminProjectId = adminAuth.app?.options?.projectId || \"unknown\"\n      console.log(\n        `[AuthSession] adminProjectId=${adminProjectId} token.aud=${payload?.aud || \"unknown\"} token.uid=${payload?.sub || \"\"} token.email=${payload?.email || \"\"}`\n      )\n    }\n\n    // Verify first so we don't set junk tokens.\n    let verificationError: any = null\n    try {\n      await adminAuth.verifyIdToken(idToken)\n    } catch (err) {\n      verificationError = err\n    }\n\n    const allowUnverifiedInDev = process.env.NODE_ENV === \"development\"\n    if (verificationError && !allowUnverifiedInDev) {\n      throw verificationError\n    }\n    if (verificationError && allowUnverifiedInDev) {\n      console.warn(\n        `[AuthSession] Skipping token verification in development: ${verificationError?.message || verificationError}`\n      )\n    }\n\n    // Keep it simple for MVP: store the ID token itself.\n    // (If you want long-lived sessions later, swap to createSessionCookie.)\n    const res = NextResponse.json({\n      ok: true,\n      verified: !verificationError,\n      warning: verificationError ? \"Token verification skipped in development.\" : undefined,\n    })\n    res.cookies.set({\n      name: SESSION_COOKIE_NAME,\n      value: idToken,\n      httpOnly: true,\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\",\n      path: \"/\",\n    })\n    return res\n  } catch (e: any) {\n    return NextResponse.json(\n      {\n        error: e?.message || \"Failed to create session\",\n        code: e?.code || e?.errorInfo?.code || null,\n      },\n      { status: 401 }\n    )\n  }\n}\n\nexport async function DELETE() {\n  const res = NextResponse.json({ ok: true })\n  res.cookies.set({\n    name: SESSION_COOKIE_NAME,\n    value: \"\",\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: process.env.NODE_ENV === \"production\",\n    path: \"/\",\n    maxAge: 0,\n  })\n  return res\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEA,MAAM,sBAAsB;AAE5B,SAAS,iBAAiB,KAAa;IACrC,MAAM,QAAQ,MAAM,KAAK,CAAC;IAC1B,IAAI,MAAM,MAAM,GAAG,GAAG,OAAO;IAC7B,IAAI;QACF,MAAM,SAAS,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM,OAAO,MAAM,KAAK,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,GAAG,CAAC,IAAI;QACpG,OAAO,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,QAAQ,UAAU,QAAQ,CAAC;IAC3D,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAQ,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM;QAC/C,MAAM,UAAU,MAAM;QAEtB,IAAI,CAAC,SAAS;YACZ,OAAO,wTAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,UAAU,iBAAiB;QAEjC,wCAA4C;YAC1C,MAAM,iBAAiB,uIAAS,CAAC,GAAG,EAAE,SAAS,aAAa;YAC5D,QAAQ,GAAG,CACT,CAAC,6BAA6B,EAAE,eAAe,WAAW,EAAE,SAAS,OAAO,UAAU,WAAW,EAAE,SAAS,OAAO,GAAG,aAAa,EAAE,SAAS,SAAS,IAAI;QAE/J;QAEA,4CAA4C;QAC5C,IAAI,oBAAyB;QAC7B,IAAI;YACF,MAAM,uIAAS,CAAC,aAAa,CAAC;QAChC,EAAE,OAAO,KAAK;YACZ,oBAAoB;QACtB;QAEA,MAAM,uBAAuB,oDAAyB;QACtD,IAAI,qBAAqB,CAAC,sBAAsB;YAC9C,MAAM;QACR;QACA,IAAI,qBAAqB,sBAAsB;YAC7C,QAAQ,IAAI,CACV,CAAC,0DAA0D,EAAE,mBAAmB,WAAW,mBAAmB;QAElH;QAEA,qDAAqD;QACrD,wEAAwE;QACxE,MAAM,MAAM,wTAAY,CAAC,IAAI,CAAC;YAC5B,IAAI;YACJ,UAAU,CAAC;YACX,SAAS,oBAAoB,+CAA+C;QAC9E;QACA,IAAI,OAAO,CAAC,GAAG,CAAC;YACd,MAAM;YACN,OAAO;YACP,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;QACR;QACA,OAAO;IACT,EAAE,OAAO,GAAQ;QACf,OAAO,wTAAY,CAAC,IAAI,CACtB;YACE,OAAO,GAAG,WAAW;YACrB,MAAM,GAAG,QAAQ,GAAG,WAAW,QAAQ;QACzC,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,MAAM,MAAM,wTAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;IACzC,IAAI,OAAO,CAAC,GAAG,CAAC;QACd,MAAM;QACN,OAAO;QACP,UAAU;QACV,UAAU;QACV,QAAQ,oDAAyB;QACjC,MAAM;QACN,QAAQ;IACV;IACA,OAAO;AACT"}}]
}